name: Validate Addon Manifest

on:
  push:
    branches:
      - main
    paths:
      - 'manifest.json'
  pull_request:
    branches:
      - main
    paths:
      - 'manifest.json'

jobs:
  validate:
    name: Validate Manifest
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Validate manifest.json syntax
        run: |
          python3 -m json.tool manifest.json > /dev/null
          echo "✅ manifest.json syntax valide"

      - name: Check required fields
        run: |
          python3 << 'PYEOF'
          import json
          
          required_fields = ['name', 'version', 'slug', 'description', 'arch', 'startup', 'boot']
          
          with open('manifest.json') as f:
              manifest = json.load(f)
          
          missing = [field for field in required_fields if field not in manifest]
          
          if missing:
              print(f"❌ Champs manquants: {', '.join(missing)}")
              exit(1)
          
          print("✅ Tous les champs requis sont présents")
          PYEOF
